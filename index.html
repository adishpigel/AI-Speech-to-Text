<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Speech to Text</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #3B82F6;
            --secondary: #10B981;
            --accent: #6366F1;
            --error: #EF4444;
            --success: #22C55E;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 50;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background: #E5E7EB;
            border-radius: 1rem;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        .process-log {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            width: 300px;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            display: none;
        }

        .process-log.show {
            display: block;
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2563EB;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.375rem;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-6">
        <div class="card bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-2xl font-bold text-center mb-6">AI Speech to Text</h1>
            
            <div class="input-group">
                <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                <div class="relative">
                    <input type="password" id="apiKey" class="input pr-10" 
                           placeholder="הכנס מפתח API של Groq">
                    <button onclick="toggleApiVisibility()" 
                            class="absolute left-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                        👁️
                    </button>
                </div>
                <button onclick="openApiGuide()" class="text-blue-500 text-sm mt-1 hover:underline">
                    אין לך מפתח API? לחץ כאן
                </button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">שפת מקור</label>
                    <select id="sourceLanguage" class="input">
                        <option value="auto">זיהוי אוטומטי</option>
                        <option value="he">עברית</option>
                        <option value="en">אנגלית</option>
                        <option value="ar">ערבית</option>
                        <option value="ru">רוסית</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">פורמט פלט</label>
                    <select id="outputFormat" class="input">
                        <option value="text">טקסט רגיל</option>
                        <option value="srt">כתוביות SRT</option>
                    </select>
                </div>
            </div>

            <input type="file" id="audioFile" accept="audio/*" class="hidden">
            
            <div class="flex gap-4 mb-4">
                <button onclick="document.getElementById('audioFile').click()" 
                        class="btn btn-primary flex-1">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    בחר קובץ אודיו
                </button>
                <button id="recordButton" 
                        class="btn btn-secondary flex-1" 
                        onclick="toggleRecording()">
                    <span id="recordingIndicator" class="hidden blink">●</span>
                    התחל הקלטה
                </button>
            </div>

            <div id="fileInfo" class="mb-4"></div>

            <button id="transcribeButton" 
                    onclick="startTranscription()" 
                    class="btn btn-primary w-full"
                    disabled>
                תמלל
            </button>
        </div>

        <div id="transcriptionResult" class="hidden">
            <!-- תוצאות התמלול יוצגו כאן -->
        </div>
    </div>

    <!-- מודל API -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <h2 class="text-xl font-bold mb-4">קבלת מפתח API</h2>
            <div class="space-y-4">
                <p>👋 ברוכים הבאים! בואו נשיג מפתח API:</p>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="font-bold mb-2">שלבים:</h3>
                    <ol class="list-decimal list-inside space-y-2">
                        <li class="flex items-center">
                            <span>היכנס ל-</span>
                            <a href="https://console.groq.com" 
                               target="_blank" 
                               class="text-blue-600 hover:underline mx-1">Groq Console</a>
                        </li>
                        <li>הירשם או התחבר לחשבון</li>
                        <li>לחץ על "API Keys" בתפריט</li>
                        <li>צור מפתח חדש והעתק אותו</li>
                        <li>הדבק את המפתח בשדה למעלה</li>
                    </ol>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <p class="text-yellow-800">
                        ⚠️ שמור על המפתח בצורה מאובטחת. אל תשתף אותו עם אף אחד!
                    </p>
                </div>

                <button onclick="closeApiGuide()" 
                        class="btn btn-primary w-full">
                    הבנתי
                </button>
            </div>
        </div>
    </div>

    <!-- חלון תהליך -->
    <div id="processLog" class="process-log">
        <h3 class="font-bold mb-2">תהליך העבודה</h3>
        <div id="logContent" class="text-sm space-y-1"></div>
    </div>

    <script>
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let audioFile = null;

        // טעינת API key מהזיכרון
        document.getElementById('apiKey').value = localStorage.getItem('groqApiKey') || '';

        function toggleApiVisibility() {
            const input = document.getElementById('apiKey');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function openApiGuide() {
            document.getElementById('apiModal').classList.add('show');
        }

        function closeApiGuide() {
            document.getElementById('apiModal').classList.remove('show');
        }

        // בדיקת API key בטעינת הדף
        document.addEventListener('DOMContentLoaded', () => {
            if (!localStorage.getItem('groqApiKey')) {
                openApiGuide();
            }
        });

        document.getElementById('audioFile').addEventListener('change', handleFileSelect);

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                showProcessLog(`נבחר קובץ: ${file.name}`);
                
                const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                const info = document.getElementById('fileInfo');
                
                info.innerHTML = `
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">פרטי הקובץ:</h4>
                        <div class="text-sm space-y-1">
                            <p>📄 שם: ${file.name}</p>
                            <p>📊 גודל: ${fileSize} MB</p>
                            <p>🎵 סוג: ${file.type}</p>
                        </div>
                    </div>
                `;

                if (file.size > 25 * 1024 * 1024) {
                    const chunks = Math.ceil(file.size / (25 * 1024 * 1024));
                    info.innerHTML += `
                        <div class="mt-2 bg-yellow-50 p-2 rounded-lg">
                            <p>⚠️ הקובץ יחולק ל-${chunks} חלקים לעיבוד</p>
                        </div>
                    `;
                }

                audioFile = file;
                document.getElementById('transcribeButton').disabled = false;
            }
        }

        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    audioFile = new File([audioBlob], 'recording.wav', { type: 'audio/wav' });
                    showProcessLog('הקלטה הושלמה');
                    document.getElementById('transcribeButton').disabled = false;
                    document.getElementById('fileInfo').innerHTML = `
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p>✅ הקלטה נשמרה בהצלחה</p>
                        </div>
                    `;
                };

                mediaRecorder.start();
                isRecording = true;
                document.getElementById('recordButton').innerHTML = `
                    <span id="recordingIndicator" class="blink">●</span>
                    עצור הקלטה
                `;
                document.getElementById('recordButton').classList.replace('btn-secondary', 'btn-error');
                showProcessLog('התחלת הקלטה');

            } catch (err) {
                showError('שגיאה בגישה למיקרופון: ' + err.message);
            }
        }

        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                document.getElementById('recordButton').innerHTML = 'התחל הקלטה';
                document.getElementById('recordButton').classList.replace('btn-error', 'btn-secondary');
            }
        }

        function showProcessLog(message) {
            const log = document.getElementById('processLog');
            const content = document.getElementById('logContent');
            const time = new Date().toLocaleTimeString();
            
            content.innerHTML += `
                <div class="border-l-2 border-blue-500 pl-2">
                    <span class="text-gray-500">${time}</span>
                    <span class="ml-2">${message}</span>
                </div>
            `;
            
            log.classList.add('show');
            content.scrollTop = content.scrollHeight;
        }

        function showError(message) {
            const error = document.createElement('div');
            error.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg';
            error.textContent = message;
            document.body.appendChild(error);
            setTimeout(() => error.remove(), 5000);
        }
        async function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        try {
            // הצג מידע על הקובץ
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `
                <div class="p-4 bg-blue-50 rounded-lg">
                    <p class="font-medium">פרטי הקובץ:</p>
                    <p>שם: ${file.name}</p>
                    <p>גודל: ${(file.size / (1024 * 1024)).toFixed(2)} MB</p>
                    <p>סוג: ${file.type}</p>
                </div>
            `;

            // בדיקת גודל קובץ וחלוקה במידת הצורך
            const CHUNK_SIZE = 25 * 1024 * 1024; // 25MB
            if (file.size > CHUNK_SIZE) {
                const chunks = Math.ceil(file.size / CHUNK_SIZE);
                fileInfo.innerHTML += `
                    <div class="mt-2 p-2 bg-yellow-50 rounded">
                        <p>⚠️ הקובץ יחולק ל-${chunks} חלקים לעיבוד</p>
                    </div>
                `;
            }

            audioFile = file;
            document.getElementById('transcribeButton').disabled = false;

        } catch (err) {
            showError(err.message);
        }
    }
}

נוסיף מידע על התקדמות התמלול:

javascriptCopyasync function transcribeAudio() {
    if (!audioFile || !apiKey) {
        showError('נא לבחור קובץ ולהזין מפתח API');
        return;
    }

    const progressContainer = document.getElementById('progressInfo');
    progressContainer.innerHTML = `
        <div class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg max-w-md w-full">
                <h3 class="text-lg font-bold mb-4">מתבצע תמלול...</h3>
                <div class="space-y-4">
                    <div class="progress-status"></div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="current-action"></div>
                </div>
            </div>
        </div>
    `;

    try {
        const CHUNK_SIZE = 25 * 1024 * 1024;
        const chunks = [];
        let offset = 0;

        // חלוקת הקובץ לחלקים
        while (offset < audioFile.size) {
            const chunk = audioFile.slice(offset, offset + CHUNK_SIZE);
            chunks.push(chunk);
            offset += CHUNK_SIZE;
        }

        let fullTranscription = '';
        for (let i = 0; i < chunks.length; i++) {
            updateProgress(
                `מעבד חלק ${i + 1} מתוך ${chunks.length}`,
                (i / chunks.length) * 100
            );

            const formData = new FormData();
            formData.append('file', chunks[i]);
            formData.append('model', 'whisper-large-v3');
            formData.append('response_format', 'verbose_json');

            if (sourceLanguage !== 'auto') {
                formData.append('language', sourceLanguage);
            }

            const response = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`
                },
                body: formData
            });

            if (!response.ok) {
                throw new Error(`שגיאה בתמלול: ${response.statusText}`);
            }

            const result = await response.json();
            
            // עדכון זמני התחלה וסיום לפי החלק הנוכחי
            if (result.segments) {
                const timeOffset = i * (CHUNK_SIZE / audioFile.size) * getTotalDuration();
                result.segments = result.segments.map(segment => ({
                    ...segment,
                    start: segment.start + timeOffset,
                    end: segment.end + timeOffset
                }));
            }

            fullTranscription += result.text + ' ';
            updateProgress(
                `הושלם חלק ${i + 1} מתוך ${chunks.length}`,
                ((i + 1) / chunks.length) * 100
            );
        }

        showFinalResult(fullTranscription.trim());

    } catch (error) {
        showError(`שגיאה בתמלול: ${error.message}`);
    } finally {
        progressContainer.innerHTML = '';
    }
}

function updateProgress(action, percent) {
    const progressStatus = document.querySelector('.progress-status');
    const progressFill = document.querySelector('.progress-fill');
    const currentAction = document.querySelector('.current-action');

    if (progressStatus && progressFill && currentAction) {
        progressStatus.textContent = `${Math.round(percent)}% הושלם`;
        progressFill.style.width = `${percent}%`;
        currentAction.textContent = action;
    }
}

function getTotalDuration() {
    // אומדן משוער של משך האודיו לפי גודל הקובץ
    // ניתן לשפר את הדיוק על ידי קריאת מטא-דאטה של הקובץ
    const BYTES_PER_SECOND = 32000; // הערכה גסה
    return audioFile.size / BYTES_PER_SECOND;
}

נוסיף תצוגת מידע על התהליך:

javascriptCopyfunction showProcessInfo(info) {
    const infoContainer = document.getElementById('processInfo');
    const now = new Date().toLocaleTimeString();
    
    infoContainer.innerHTML += `
        <div class="text-sm text-gray-600 border-l-4 border-blue-500 pl-2 mb-2">
            ${now}: ${info}
        </div>
    `;
    infoContainer.scrollTop = infoContainer.scrollHeight;
}

// הוספת חלון מידע לממשק
const processInfoHTML = `
    <div class="fixed bottom-4 right-4 w-80 bg-white rounded-lg shadow-lg p-4">
        <h4 class="font-bold mb-2">תהליך העבודה</h4>
        <div id="processInfo" class="h-48 overflow-y-auto"></div>
    </div>
`;
document.body.insertAdjacentHTML('beforeend', processInfoHTML);
תכונות שנוספו:

חיווי מפורט על גודל הקובץ וחלוקה לחלקים
מידע חי על התקדמות התמלול
הצגת פעולות שמתבצעות ברקע
אומדן זמנים ומשך תמלול
חלון מידע שמראה את כל התהליך בזמן אמת

אם תרצה, אפשר להוסיף גם:

שמירת היסטוריה של תמלולים
אפשרות לביטול תהליך באמצע
סטטיסטיקות על התמלול
חיווי מפורט יותר על איכות התמלול

האם תרצה שאוסיף תכונות נוספות או שאפרט יותר על חלק מסוים? CopyRetryClaude does not have the ability to run the code it generates yet.ASנא צור את הקוד החדש עם התיקונים החדשים וצור את הקישור ל API כחלון נפתח במקרה שאין API מוגדרEditאכין גרסה משופרת עם חלון מודל ל-API וכל התיקונים החדשים:
Enhanced Transcription App with API ModalClick to open website CopyRetryClaude’s response was limited as it hit the maximum length allowed at this time.ASלא  סיימת וכמו כן נא הוסף אפשרות העתקה של הקובץ בכל אחד מהפורמטים המוצעיםEditאשלים את הקוד עם אפשרויות ההעתקה והמשך הפונקציות:
javascriptCopy// המשך הקוד הקודם...

async function startTranscription() {
    const apiKey = document.getElementById('apiKey').value;
    if (!apiKey) {
        showError('נא להזין מפתח API');
        openApiGuide();
        return;
    }

    const transcribeButton = document.getElementById('transcribeButton');
    transcribeButton.disabled = true;
    transcribeButton.innerHTML = '<span class="blink">●</span> מתבצע תמלול...';

    showProcessLog('מתחיל תמלול');

    try {
        const chunks = await prepareAudioChunks(audioFile);
        const transcription = await processChunks(chunks, apiKey);
        showTranscriptionResult(transcription);
    } catch (error) {
        showError(error.message);
    } finally {
        transcribeButton.disabled = false;
        transcribeButton.innerHTML = 'תמלל';
    }
}

async function prepareAudioChunks(file) {
    const CHUNK_SIZE = 25 * 1024 * 1024; // 25MB
    const chunks = [];
    
    if (file.size > CHUNK_SIZE) {
        let offset = 0;
        while (offset < file.size) {
            const chunk = file.slice(offset, offset + CHUNK_SIZE);
            chunks.push(new File([chunk], `chunk_${chunks.length + 1}.wav`, { type: file.type }));
            offset += CHUNK_SIZE;
            showProcessLog(`הוכן חלק ${chunks.length} מתוך ${Math.ceil(file.size / CHUNK_SIZE)}`);
        }
    } else {
        chunks.push(file);
    }

    return chunks;
}

async function processChunks(chunks, apiKey) {
    let fullTranscription = {
        text: '',
        segments: []
    };

    for (let i = 0; i < chunks.length; i++) {
        showProcessLog(`מעבד חלק ${i + 1} מתוך ${chunks.length}`);
        
        const formData = new FormData();
        formData.append('file', chunks[i]);
        formData.append('model', 'whisper-large-v3');
        formData.append('response_format', 'verbose_json');

        const sourceLanguage = document.getElementById('sourceLanguage').value;
        if (sourceLanguage !== 'auto') {
            formData.append('language', sourceLanguage);
        }

        try {
            const response = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`
                },
                body: formData
            });

            if (!response.ok) throw new Error(`שגיאת API: ${response.statusText}`);

            const result = await response.json();
            
            // חישוב הסטת זמן לפי החלק הנוכחי
            const timeOffset = calculateTimeOffset(i, chunks.length);
            
            if (result.segments) {
                result.segments = result.segments.map(segment => ({
                    ...segment,
                    start: segment.start + timeOffset,
                    end: segment.end + timeOffset
                }));
                fullTranscription.segments.push(...result.segments);
            }
            
            fullTranscription.text += result.text + ' ';
            updateTranscriptionProgress((i + 1) / chunks.length * 100);
        } catch (error) {
            showError(`שגיאה בעיבוד חלק ${i + 1}: ${error.message}`);
            throw error;
        }
    }

    return fullTranscription;
}

function showTranscriptionResult(transcription) {
    const resultContainer = document.getElementById('transcriptionResult');
    const outputFormat = document.getElementById('outputFormat').value;
    
    let formattedContent = '';
    if (outputFormat === 'srt') {
        formattedContent = formatSRT(transcription.segments);
    } else {
        formattedContent = transcription.text;
    }

    resultContainer.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <div class="flex justify-between mb-4">
                <h3 class="text-lg font-bold">תוצאות התמלול</h3>
                <div class="space-x-2">
                    <select id="exportFormat" class="input">
                        <option value="text">טקסט רגיל</option>
                        <option value="srt">SRT</option>
                        <option value="vtt">VTT</option>
                        <option value="json">JSON</option>
                    </select>
                    <button onclick="copyTranscription()" class="btn btn-secondary">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                        העתק
                    </button>
                    <button onclick="downloadTranscription()" class="btn btn-primary">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        הורד
                    </button>
                </div>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto font-mono whitespace-pre-wrap">
                ${formattedContent}
            </div>
        </div>
    `;

    resultContainer.classList.remove('hidden');
    showProcessLog('תמלול הושלם');
}

function copyTranscription() {
    const format = document.getElementById('exportFormat').value;
    const transcription = document.getElementById('transcriptionResult')
        .querySelector('.font-mono').textContent;
    
    let contentToCopy = transcription;
    if (format === 'json') {
        contentToCopy = JSON.stringify(
            { transcription: transcription },
            null,
            2
        );
    }

    navigator.clipboard.writeText(contentToCopy).then(() => {
        showProcessLog('הטקסט הועתק בפורמט ' + format);
    }).catch(err => {
        showError('שגיאה בהעתקה: ' + err.message);
    });
}

function downloadTranscription() {
    const format = document.getElementById('exportFormat').value;
    const transcription = document.getElementById('transcriptionResult')
        .querySelector('.font-mono').textContent;
    
    let content = transcription;
    let mimeType = 'text/plain';
    let extension = 'txt';

    switch (format) {
        case 'srt':
            extension = 'srt';
            break;
        case 'vtt':
            content = convertToVTT(transcription);
            extension = 'vtt';
            break;
        case 'json':
            content = JSON.stringify({ transcription: transcription }, null, 2);
            mimeType = 'application/json';
            extension = 'json';
            break;
    }

    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `transcription.${extension}`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showProcessLog(`הקובץ הורד בפורמט ${format}`);
}

function convertToVTT(srtContent) {
    if (!srtContent.includes('-->')) return srtContent;
    
    return 'WEBVTT\n\n' + srtContent
        .replace(/(\d{2}:\d{2}:\d{2}),(\d{3})/g, '$1.$2');
}

function formatSRT(segments) {
    return segments.map((segment, index) => {
        const startTime = formatTimestamp(segment.start);
        const endTime = formatTimestamp(segment.end);
        return `${index + 1}\n${startTime} --> ${endTime}\n${segment.text}\n`;
    }).join('\n');
}

function formatTimestamp(seconds) {
    const date = new Date(seconds * 1000);
    const hours = date.getUTCHours().toString().padStart(2, '0');
    const minutes = date.getUTCMinutes().toString().padStart(2, '0');
    const secs = date.getUTCSeconds().toString().padStart(2, '0');
    const ms = date.getUTCMilliseconds().toString().padStart(3, '0');
    return `${hours}:${minutes}:${secs},${ms}`;
}

function calculateTimeOffset(chunkIndex, totalChunks) {
    // מחשב את הסטת הזמן לפי החלק הנוכחי
    return (chunkIndex / totalChunks) * estimateTotalDuration();
}

function estimateTotalDuration() {
    // הערכה גסה של משך האודיו לפי גודל הקובץ
    // ניתן לשפר את הדיוק על ידי קריאת מטא-דאטה של הקובץ
    const BYTES_PER_SECOND = 32000;
    return audioFile.size / BYTES_PER_SECOND;
}

function updateTranscriptionProgress(percent) {
    const progressBar = document.querySelector('.progress-fill');
    if (progressBar) {
        progressBar.style.width = `${percent}%`;
        showProcessLog(`התקדמות: ${Math.round(percent)}%`);
    }
}
